(this["webpackJsonp_react-admin"]=this["webpackJsonp_react-admin"]||[]).push([[13],{1079:function(e,t,a){var n=a(140),r=a(1080);"string"===typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var c={insert:"head",singleton:!1};n(r,c);e.exports=r.locals||{}},1080:function(e,t,a){"use strict";a.r(t);var n=a(83),r=a.n(n)()(!0);r.push([e.i,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]),t.default=r},937:function(e,t,a){"use strict";a.r(t);var n,r=a(5),c=a.n(r),i=(a(337),a(193)),s=(a(191),a(65)),o=a(10),u=a(24),l=(a(954),a(955)),d=a(50),j=a(0),b=a(192),h=a(1096),p=a(329),x=a(1097),f=a(1102),O=a(1098),m=a(1094),g=a(1099),v=(a(963),a(965)),y=(a(964),a(966)),w=(a(1015),a(1023)),S=a(1095),k=a(462),C=a(195),K=(a(486),a(336)),T=a(201),R=a(151),E=a(1016),F=a(1017),L=a(1025),M=a(1021),I=a(27),A=a(1093),H=a(134),D=a(8),N=Object(A.a)(m.a),P=Object(b.a)({ajax:!0})(n=function(e){Object(L.a)(a,e);var t=Object(M.a)(a);function a(){var e;Object(E.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={loading:!1,dataSource:[],menuTreeData:[],allMenuKeys:[],expandedRowKeys:[],expandedAll:!0},e.columns=[{title:"\u540d\u79f0",dataIndex:"title",key:"title"},{title:"\u7c7b\u578b",dataIndex:"type",key:"type",width:100,render:function(e,t){var a;if(2===e)return"\u529f\u80fd\u6743\u9650\u7801";var n=t.target;return(null===(a=H.a.find((function(e){return e.value===n})))||void 0===a?void 0:a.label)||"-"}}],e.fetchMenus=Object(o.a)(c.a.mark((function t(){var a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.ajax.get("/menus");case 2:return a=t.sent,t.abrupt("return",(a||[]).map((function(e){return Object(u.a)({},e)})));case 4:case"end":return t.stop()}}),t)}))),e.handleSearch=Object(o.a)(c.a.mark((function t(){var a,n,r,i;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.setState({loading:!0}),t.prev=1,e.setState({loading:!1}),t.t0=e.props.menus,t.t0){t.next=8;break}return t.next=7,e.fetchMenus();case 7:t.t0=t.sent;case 8:a=t.t0,n=a.map((function(e){return e.id})),r=Object(I.c)(a),i=Object(R.a)(n),e.setState({dataSource:r,menuTreeData:r,allMenuKeys:n,expandedRowKeys:i}),t.next=19;break;case 15:throw t.prev=15,t.t1=t.catch(1),e.setState({loading:!1}),t.t1;case 19:case"end":return t.stop()}}),t,null,[[1,15]])}))),e.handleSearchValue=function(t){var a=e.state,n=a.menuTreeData,r=a.allMenuKeys,c=Object(I.d)(n,(function(e){return[e.title,e.path,e.name,e.code].some((function(e){return(e||"").toLowerCase().includes(t)}))}));e.setState({dataSource:c,expandedAll:!0,expandedRowKeys:r})},e.handleSearchChange=function(t){e.timer&&clearTimeout(e.timer),e.timer=setTimeout((function(){return e.handleSearchValue(t.target.value)}),300)},e.handleToggleExpanded=function(){var t=e.state,a=t.expandedAll,n=t.allMenuKeys,r=a?[]:n;e.setState({expandedAll:!a,expandedRowKeys:r})},e}return Object(F.a)(a,[{key:"componentDidMount",value:function(){var e=this;Object(o.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.handleSearch();case 2:case"end":return t.stop()}}),t)})))()}},{key:"render",value:function(){var e=this,t=this.state,a=t.dataSource,n=t.loading,r=t.expandedRowKeys,c=t.expandedAll,i=this.props,o=i.value,l=i.onChange,d=i.disabled,j=Object(T.a)(i,["value","onChange","disabled"]);return Object(D.jsxs)(D.Fragment,{children:[Object(D.jsxs)("div",{style:{padding:8,width:"100%",display:"flex",alignItems:"center"},children:[Object(D.jsx)(K.a.Search,{style:{flex:1},allowClear:!0,placeholder:"\u8f93\u5165\u5173\u952e\u5b57\u8fdb\u884c\u641c\u7d22",onSearch:this.handleSearchValue,onChange:this.handleSearchChange}),Object(D.jsxs)(s.a,{type:"text",style:{flex:0,marginLeft:16},onClick:this.handleToggleExpanded,children:["\u5168\u90e8",c?"\u6536\u8d77":"\u5c55\u5f00"]})]}),Object(D.jsx)(N,Object(u.a)({expandable:{expandedRowKeys:r,onExpandedRowsChange:function(t){return e.setState({expandedRowKeys:t})}},rowSelection:{getCheckboxProps:function(){return{disabled:d}},selectedRowKeys:o,onChange:l},loading:n,columns:this.columns,dataSource:a,pagination:!1,rowKey:"id",size:"small"},j))]})}}]),a}(j.Component))||n,V=a(16),z=Object(b.a)({modal:{title:function(e){return e.isEdit?"\u7f16\u8f91\u89d2\u8272":"\u521b\u5efa\u89d2\u8272"},width:"70%",top:50}})((function(e){var t=e.record,a=e.isEdit,n=e.onOk,r=Object(j.useState)(!1),i=Object(d.a)(r,2),s=i[0],b=i[1],h=l.a.useForm(),p=Object(d.a)(h,1)[0];e.ajax.useGet("/roles/".concat(null===t||void 0===t?void 0:t.id),null,[],{setLoading:b,mountFire:a,formatResult:function(e){if(e){var t=Object(u.a)({},e);p.setFieldsValue(t)}}});var x=e.ajax.usePost("/roles",null,{setLoading:b,successTip:"\u521b\u5efa\u6210\u529f\uff01"}).run,O=e.ajax.usePut("/roles",null,{setLoading:b,successTip:"\u4fee\u6539\u6210\u529f\uff01"}).run,m=e.ajax.useGet("/roleByName").run;function g(){return(g=Object(o.a)(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Object(u.a)({},t),!a){e.next=6;break}return e.next=4,O(r);case 4:e.next=8;break;case 6:return e.next=8,x(r);case 8:n();case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K=Object(C.a)(function(){var e=Object(o.a)(c.a.mark((function e(t,n){var r,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,m({name:n});case 4:if(r=e.sent){e.next=7;break}return e.abrupt("return");case 7:if(i=p.getFieldValue("id"),!a||r.id===i||r.name!==n){e.next=10;break}throw Error("\u89d2\u8272\u540d\u4e0d\u80fd\u91cd\u590d\uff01");case 10:if(a||r.name!==n){e.next=12;break}throw Error("\u89d2\u8272\u540d\u4e0d\u80fd\u91cd\u590d\uff01");case 12:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),T={labelCol:{flex:"100px"}},R={xs:{span:24},sm:{span:12}};return Object(D.jsx)(S.a,{loading:s,okText:"\u4fdd\u5b58",onOk:function(){return p.submit()},cancelText:"\u91cd\u7f6e",onCancel:function(){return p.resetFields()},children:Object(D.jsxs)(l.a,{form:p,name:"roleEdit",onFinish:function(e){return g.apply(this,arguments)},children:[a?Object(D.jsx)(f.a,{hidden:!0,name:"id"}):null,Object(D.jsxs)(v.a,{gutter:8,children:[Object(D.jsx)(y.a,Object(u.a)(Object(u.a)({},R),{},{style:{marginBottom:V.h?16:0},children:Object(D.jsx)(w.a,{title:"\u57fa\u7840\u4fe1\u606f",children:Object(D.jsxs)(k.a,{fitHeight:!V.h,otherHeight:160,children:[Object(D.jsx)(f.a,Object(u.a)(Object(u.a)({},T),{},{label:"\u89d2\u8272\u540d\u79f0",name:"name",required:!0,noSpace:!0,maxLength:50,rules:[{validator:K}]})),Object(D.jsx)(f.a,Object(u.a)(Object(u.a)({},T),{},{type:"textarea",label:"\u5907\u6ce8",name:"remark",maxLength:250}))]})})})),Object(D.jsx)(y.a,Object(u.a)(Object(u.a)({},R),{},{children:Object(D.jsx)(w.a,{title:"\u6743\u9650\u914d\u7f6e",bodyStyle:{padding:0},children:Object(D.jsx)(f.a,Object(u.a)(Object(u.a)({},T),{},{name:"menuIds",children:Object(D.jsx)(P,{fitHeight:!0,otherHeight:200})}))})}))]})]})})})),_=a(1079),G=a.n(_);t.default=Object(b.a)({path:"/roles"})((function(e){var t=Object(j.useState)(!1),a=Object(d.a)(t,2),n=a[0],r=a[1],b=Object(j.useState)(1),v=Object(d.a)(b,2),y=v[0],w=v[1],S=Object(j.useState)(20),k=Object(d.a)(S,2),C=k[0],K=k[1],T=Object(j.useState)({}),R=Object(d.a)(T,2),E=R[0],F=R[1],L=Object(j.useState)(null),M=Object(d.a)(L,2),I=M[0],A=M[1],H=Object(j.useState)(!1),N=Object(d.a)(H,2),P=N[0],_=N[1],B=l.a.useForm(),J=Object(d.a)(B,1)[0],q=Object(u.a)(Object(u.a)({},E),{},{pageNum:y,pageSize:C}),Q=e.ajax.useGet("/roles",q,[E,y,C],{setLoading:r,formatResult:function(e){return{dataSource:(null===e||void 0===e?void 0:e.list)||[],total:(null===e||void 0===e?void 0:e.total)||0}}}).data,U=(Q=void 0===Q?{}:Q).dataSource,W=Q.total,X=e.ajax.useDel("/roles/:id",null,{setLoading:r,successTip:"\u5220\u9664\u6210\u529f\uff01"}).run,Y=[{title:"\u89d2\u8272\u540d\u79f0",dataIndex:"name"},{title:"\u5907\u6ce8",dataIndex:"remark"},{title:"\u64cd\u4f5c",dataIndex:"operator",width:100,render:function(e,t){var a=t.id,n=t.name,r=[{label:"\u7f16\u8f91",onClick:function(){return A(t)||_(!0)}},{label:"\u5220\u9664",color:"red",confirm:{title:"\u60a8\u786e\u5b9a\u5220\u9664\u300c".concat(n,"\u300d\u5417\uff1f"),onConfirm:function(){return function(e){return Z.apply(this,arguments)}(a)}}}];return Object(D.jsx)(h.a,{items:r})}}];function Z(){return(Z=Object(o.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X(t);case 2:F(Object(u.a)({},E));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(D.jsxs)(p.a,{fitHeight:!0,className:G.a.root,loading:n,children:[Object(D.jsx)(x.a,{children:Object(D.jsxs)(l.a,{name:"role",layout:"inline",form:J,onFinish:function(e){w(1),F(e)},children:[Object(D.jsx)(f.a,Object(u.a)(Object(u.a)({},{wrapperCol:{style:{width:200}}}),{},{label:"\u89d2\u8272\u540d\u79f0",name:"name"})),Object(D.jsx)(f.a,{children:Object(D.jsxs)(i.b,{children:[Object(D.jsx)(s.a,{type:"primary",htmlType:"submit",children:"\u67e5\u8be2"}),Object(D.jsx)(s.a,{htmlType:"reset",children:"\u91cd\u7f6e"})]})})]})}),Object(D.jsx)(O.a,{children:Object(D.jsx)(s.a,{type:"primary",onClick:function(){return A(null)||_(!0)},children:"\u6dfb\u52a0"})}),Object(D.jsx)(m.a,{fitHeight:!V.h,scroll:V.h?{x:1e3}:void 0,dataSource:U,columns:Y,rowKey:"id",pagination:!1}),Object(D.jsx)(g.a,{total:W,pageNum:y,pageSize:C,onPageNumChange:w,onPageSizeChange:function(e){return w(1)||K(e)}}),Object(D.jsx)(z,{fullScreen:V.h,width:V.h?"100%":"70%",visible:P,isEdit:!!I,record:I,onOk:function(){return _(!1)||F(Object(u.a)({},E))},onCancel:function(){return _(!1)}})]})}))}}]);
//# sourceMappingURL=13.0d511992.chunk.js.map