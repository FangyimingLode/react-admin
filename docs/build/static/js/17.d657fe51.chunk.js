(this["webpackJsonp_react-admin"]=this["webpackJsonp_react-admin"]||[]).push([[17],{938:function(e,t,a){"use strict";a.r(t);var n,r,c,i=a(5),s=a.n(i),l=(a(337),a(193)),u=(a(191),a(65)),o=a(10),d=a(24),j=(a(954),a(955)),b=a(50),O=a(0),h=a(192),p=a(1096),f=a(329),x=a(1097),m=a(1102),g=a(1098),v=a(1094),S=a(1099),k=a(16),y=(a(963),a(965)),w=(a(964),a(966)),C=(a(1015),a(1023)),F=a(1095),I=a(462),T=a(27),V=a(195),E=(a(486),a(336)),H=a(201),L=a(151),P=a(1016),q=a(1017),z=a(1025),D=a(1021),N=a(1093),B=a(8),G=Object(N.a)(v.a),K=Object(h.a)({ajax:!0})((c=r=function(e){Object(z.a)(a,e);var t=Object(D.a)(a);function a(){var e;Object(P.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={loading:!1,dataSource:[],roles:[]},e.columns=[{title:"\u89d2\u8272\u540d",dataIndex:"name",key:"name"},{title:"\u63cf\u8ff0",dataIndex:"remark",key:"remark"}],e.handleSearch=Object(o.a)(s.a.mark((function t(){var a,n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.state.loading){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,e.setState({loading:!0}),t.next=6,e.props.ajax.get("/roles");case 6:a=t.sent,n=a||[],e.setState({dataSource:Object(L.a)(n),roles:n,loading:!1}),t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(2),e.setState({loading:!1}),t.t0;case 15:case"end":return t.stop()}}),t,null,[[2,11]])}))),e.handleSearchValue=function(t){var a=e.state.roles,n=Object(T.d)(a,(function(e){return[e.name,e.remark].some((function(e){return(e||"").toLowerCase().includes(t)}))}));e.setState({dataSource:n})},e.handleChange=function(t){e.timer&&clearTimeout(e.timer),e.timer=setTimeout((function(){return e.handleSearchValue(t.target.value)}),300)},e}return Object(q.a)(a,[{key:"componentDidMount",value:function(){var e=this;Object(o.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.handleSearch();case 2:case"end":return t.stop()}}),t)})))()}},{key:"render",value:function(){var e=this.state,t=e.dataSource,a=e.loading,n=this.props,r=n.value,c=n.onChange,i=n.fullValue,s=n.disabled,l=Object(H.a)(n,["value","onChange","fullValue","disabled"]);return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)("div",{style:{padding:8,display:"flex",alignItems:"center"},children:Object(B.jsx)(E.a.Search,{style:{flex:1},allowClear:!0,placeholder:"\u8f93\u5165\u5173\u952e\u5b57\u8fdb\u884c\u641c\u7d22",onSearch:this.handleSearchValue,onChange:this.handleChange})}),Object(B.jsx)(G,Object(d.a)({showHeader:!0,size:"small",rowSelection:{getCheckboxProps:function(){return{disabled:s}},selectedRowKeys:i?(r||[]).map((function(e){return e.id})):r,onChange:function(e,t){return c(i?t:e)}},loading:a,columns:this.columns,dataSource:t,pagination:!1,rowKey:"id"},l))]})}}]),a}(O.Component),r.defaultProps={value:[],onChange:function(){},fullValue:!1},n=c))||n,R=Object(h.a)({modal:{title:function(e){var t;return null!==e&&void 0!==e&&null!==(t=e.record)&&void 0!==t&&t.isDetail?"\u67e5\u770b\u7528\u6237":e.isEdit?"\u7f16\u8f91\u7528\u6237":"\u521b\u5efa\u7528\u6237"},width:"70%",top:50}})((function(e){var t=e.record,a=e.isEdit,n=e.onOk,r=e.onCancel,c=Object(O.useState)(!1),i=Object(b.a)(c,2),l=i[0],h=i[1],p=j.a.useForm(),f=Object(b.a)(p,1)[0],x=null===t||void 0===t?void 0:t.isDetail;e.ajax.useGet("/users/:id",{id:null===t||void 0===t?void 0:t.id},[],{mountFire:a,setLoading:h,formatResult:function(e){e&&f.setFieldsValue(e)}});var g=e.ajax.usePost("/users",null,{setLoading:h,successTip:"\u521b\u5efa\u6210\u529f\uff01"}).run,v=e.ajax.usePut("/users",null,{setLoading:h,successTip:"\u4fee\u6539\u6210\u529f\uff01"}).run,S=e.ajax.useGet("/userByAccount").run;function E(){return(E=Object(o.a)(s.a.mark((function e(t){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Object(d.a)({},t),!a){e.next=6;break}return e.next=4,v(r);case 4:e.next=8;break;case 6:return e.next=8,g(r);case 8:n();case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var H=Object(V.a)(function(){var e=Object(o.a)(s.a.mark((function e(t,n){var r,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,S({account:n});case 4:if(r=e.sent){e.next=7;break}return e.abrupt("return");case 7:if(c=f.getFieldValue("id"),!a||r.id===c||r.account!==n){e.next=10;break}throw Error("\u8d26\u53f7\u4e0d\u80fd\u91cd\u590d\uff01");case 10:if(a||r.account!==n){e.next=12;break}throw Error("\u8d26\u53f7\u4e0d\u80fd\u91cd\u590d\uff01");case 12:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),L=x,P={labelCol:{flex:"100px"},disabled:L},q={xs:{span:24},sm:{span:12}};return Object(B.jsx)(F.a,{loading:l,okText:"\u4fdd\u5b58",onOk:function(){return f.submit()},cancelText:"\u91cd\u7f6e",onCancel:function(){return f.resetFields()},fullScreen:k.h,footer:L?Object(B.jsx)(u.a,{onClick:r,children:"\u5173\u95ed"}):void 0,children:Object(B.jsxs)(j.a,{form:f,name:"roleEdit",onFinish:function(e){return E.apply(this,arguments)},children:[a?Object(B.jsx)(m.a,{hidden:!0,name:"id"}):null,Object(B.jsxs)(y.a,{gutter:8,children:[Object(B.jsx)(w.a,Object(d.a)(Object(d.a)({},q),{},{style:{marginBottom:k.h?16:0},children:Object(B.jsx)(C.a,{title:"\u57fa\u7840\u4fe1\u606f",children:Object(B.jsxs)(I.a,{fitHeight:!k.h,otherHeight:160,children:[Object(B.jsx)(m.a,Object(d.a)(Object(d.a)({},P),{},{label:"\u8d26\u53f7",name:"account",required:!0,noSpace:!0,rules:[{validator:H}]})),Object(B.jsx)(m.a,Object(d.a)(Object(d.a)({},P),{},{label:"\u5bc6\u7801",name:"password",required:!0,noSpace:!0})),Object(B.jsx)(m.a,Object(d.a)(Object(d.a)({},P),{},{label:"\u59d3\u540d",name:"name",required:!0,noSpace:!0})),Object(B.jsx)(m.a,Object(d.a)(Object(d.a)({},P),{},{label:"\u90ae\u7bb1",name:"email",rules:[T.p.email()],required:!0,noSpace:!0})),Object(B.jsx)(m.a,Object(d.a)(Object(d.a)({},P),{},{label:"\u624b\u673a\u53f7",name:"mobile",rules:[T.p.mobile()],required:!0,noSpace:!0}))]})})})),Object(B.jsx)(w.a,Object(d.a)(Object(d.a)({},q),{},{children:Object(B.jsx)(C.a,{title:"\u89d2\u8272\u914d\u7f6e",bodyStyle:{padding:0},children:Object(B.jsx)(m.a,Object(d.a)(Object(d.a)({},P),{},{name:"roleIds",children:Object(B.jsx)(K,{disabled:L,fitHeight:!k.h,otherHeight:200})}))})}))]})]})})}));t.default=Object(h.a)({path:"/users"})((function(e){var t=Object(O.useState)(!1),a=Object(b.a)(t,2),n=a[0],r=a[1],c=Object(O.useState)(1),i=Object(b.a)(c,2),h=i[0],y=i[1],w=Object(O.useState)(20),C=Object(b.a)(w,2),F=C[0],I=C[1],T=Object(O.useState)({}),V=Object(b.a)(T,2),E=V[0],H=V[1],L=Object(O.useState)(!1),P=Object(b.a)(L,2),q=P[0],z=P[1],D=Object(O.useState)(null),N=Object(b.a)(D,2),G=N[0],K=N[1],A=j.a.useForm(),J=Object(b.a)(A,1)[0],_=Object(d.a)(Object(d.a)({},E),{},{pageNum:h,pageSize:F}),M=e.ajax.useGet("/users",_,[E,h,F],{setLoading:r,formatResult:function(e){return{dataSource:(null===e||void 0===e?void 0:e.list)||[],total:e.total||0}}}).data,Q=(M=void 0===M?{}:M).dataSource,U=M.total,W=e.ajax.useDel("/users/:id",null,{setLoading:r,successTip:"\u5220\u9664\u6210\u529f\uff01"}).run,X=[{title:"\u8d26\u53f7",dataIndex:"account"},{title:"\u59d3\u540d",dataIndex:"name"},{title:"\u624b\u673a\u53f7",dataIndex:"mobile"},{title:"\u90ae\u7bb1",dataIndex:"email"},{title:"\u64cd\u4f5c",key:"operator",render:function(e,t){var a=t.id,n=t.name,r=[{label:"\u67e5\u770b",onClick:function(){return K(Object(d.a)(Object(d.a)({},t),{},{isDetail:!0}))||z(!0)}},{label:"\u4fee\u6539",onClick:function(){return K(t)||z(!0)}},{label:"\u5220\u9664",color:"red",confirm:{title:"\u60a8\u786e\u5b9a\u5220\u9664\u300c".concat(n,"\u300d\u5417\uff1f"),onConfirm:function(){return function(e){return Y.apply(this,arguments)}(a)}}}];return Object(B.jsx)(p.a,{items:r})}}];function Y(){return(Y=Object(o.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W(t);case 2:H(Object(d.a)({},E));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z={style:{width:200}};return Object(B.jsxs)(f.a,{loading:n,children:[Object(B.jsx)(x.a,{showCollapsedBar:k.h,children:function(e){var t=k.h&&e;return Object(B.jsxs)(j.a,{name:"user",layout:"inline",form:J,onFinish:function(e){return y(1)||H(e)},children:[Object(B.jsx)(m.a,Object(d.a)(Object(d.a)({},Z),{},{label:"\u8d26\u53f7",name:"account"})),Object(B.jsx)(m.a,Object(d.a)(Object(d.a)({hidden:t},Z),{},{label:"\u59d3\u540d",name:"name"})),Object(B.jsx)(m.a,Object(d.a)(Object(d.a)({hidden:t},Z),{},{label:"\u624b\u673a\u53f7",name:"mobile"})),Object(B.jsx)(m.a,{children:Object(B.jsxs)(l.b,{children:[Object(B.jsx)(u.a,{type:"primary",htmlType:"submit",children:"\u67e5\u8be2"}),Object(B.jsx)(u.a,{onClick:function(){return J.resetFields()},children:"\u91cd\u7f6e"})]})})]})}}),Object(B.jsx)(g.a,{children:Object(B.jsx)(u.a,{type:"primary",onClick:function(){return K(null)||z(!0)},children:"\u6dfb\u52a0"})}),Object(B.jsx)(v.a,{serialNumber:!0,pageNum:h,pageSize:F,fitHeight:!k.h,dataSource:Q,columns:X,rowKey:"id",pagination:!1,scroll:k.h?{x:1e3}:void 0}),Object(B.jsx)(S.a,{total:U,pageNum:h,pageSize:F,onPageNumChange:y,onPageSizeChange:function(e){return y(1)||I(e)}}),Object(B.jsx)(R,{fullScreen:k.h,width:k.h?"100%":"70%",visible:q,record:G,isEdit:!!G,onOk:function(){return z(!1)||H(Object(d.a)({},E))},onCancel:function(){return z(!1)}})]})}))}}]);
//# sourceMappingURL=17.d657fe51.chunk.js.map